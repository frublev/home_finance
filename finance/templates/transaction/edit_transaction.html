{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-success">Edit Transaction</h2>

    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.META.HTTP_REFERER }}">

        <div class="card shadow-sm p-4 mb-3">

            {{ form.as_p }}

            <!-- ðŸ”¹ Ð¢Ð•Ð“Ð˜ -->
            <div class="mb-3" id="tags-container" style="display:none;">
                <label class="form-label">Tags</label>

                <div class="d-flex flex-wrap gap-1" id="tags-list"></div>

                <input name="transaction_tags" id="transaction_tags_input" value="{% for tag in transaction.tags.all %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}">
            </div>

<!--            {% if transaction.category.tags.exists %}-->
<!--            <div class="mt-3">-->
<!--                <label class="form-label">Tags</label>-->
<!--                <div class="d-flex flex-wrap gap-1">-->
<!--                    {% for tag in transaction.category.tags.all %}-->
<!--                        <span-->
<!--                            class="badge {% if tag in transaction.tags.all %} bg-primary me-1 {% else %} bg-secondary me-1 {% endif %}"-->
<!--                            style="cursor:pointer"-->
<!--                            onclick="toggleTag('{{ tag.name|escapejs }}')"-->
<!--                            data-tag-name="{{ tag.name }}"-->
<!--                        >-->
<!--                            {{ tag.name }}-->
<!--                        </span>-->
<!--                    {% endfor %}-->
<!--                    <input name="transaction_tags" id="transaction_tags_input" value="{% for tag in transaction.tags.all %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}"">-->
<!--                </div>-->
<!--            </div>-->
<!--            {% endif %}-->

        </div>

        <button type="submit" class="btn btn-success">Save changes</button>
        <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal">
            Delete
        </button>
        <a href="javascript:history.back()" class="btn btn-outline-secondary">Back</a>
    </form>
</div>

<!-- MODAL -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Confirm Deletion</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this transaction?
      </div>
      <div class="modal-footer">
        <form method="post" action="{% url 'delete_transaction' transaction.id %}">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.META.HTTP_REFERER }}">
            <button type="submit" class="btn btn-danger">Yes, delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="{% static 'js/add_tags.js' %}"></script>

{% endblock %}