{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="filters mb-3 d-flex flex-column" style="gap: 0.5rem;">
    <!-- ðŸ”¹ Ð¡ÑÑ‹Ð»ÐºÐ¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð² -->
  <div class="d-flex align-items-center justify-content-between flex-wrap" style="gap: 1rem;">

    <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¿Ð¾ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ -->
    <div class="d-flex" style="gap: 1rem;">
      <a href="?filter=today" class="filter-link {% if active_filter == 'today' %}active{% endif %}">Today</a>
      <a href="?filter=week" class="filter-link {% if active_filter == 'week' %}active{% endif %}">Week</a>
      <a href="?filter=month" class="filter-link {% if active_filter == 'month' %}active{% endif %}">Month</a>
    </div>

<!--    <div class="filter-separator"></div>-->

    <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¿Ð¾ Ñ‚Ð¸Ð¿Ñƒ -->
    <div class="d-flex" style="gap: 1rem;">
      <a href="?{% for key, value in request.GET.items %}{% if key != 'type' %}{{ key }}={{ value }}&{% endif %}{% endfor %}type=None"
        class="type-filter-link {% if active_type == 'None' %}active{% endif %}">All</a>
      <a href="?{% for key, value in request.GET.items %}{% if key != 'type' %}{{ key }}={{ value }}&{% endif %}{% endfor %}type=income"
        class="type-filter-link {% if active_type == 'income' %}active{% endif %}">Income</a>
      <a href="?{% for key, value in request.GET.items %}{% if key != 'type' %}{{ key }}={{ value }}&{% endif %}{% endfor %}type=outcome"
        class="type-filter-link {% if active_type == 'outcome' %}active{% endif %}">Outcome</a>
      <a href="?{% for key, value in request.GET.items %}{% if key != 'type' %}{{ key }}={{ value }}&{% endif %}{% endfor %}type=transfer"
        class="type-filter-link {% if active_type == 'transfer' %}active{% endif %}">Transfer</a>
    </div>
  </div>

    <!-- ðŸ”¹ Ð¤Ð¾Ñ€Ð¼Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° -->
    <form method="get" action="" class="d-flex align-items-center" style="gap: 0.5rem; margin-top: 0.5rem;">
        <input type="hidden" name="filter" value="">
        <label for="from_date" class="form-label fw-semibold mb-0 small text-muted">From:</label>
        <input type="date" id="from_date" name="from_date" value="{{ from_date }}" class="form-control form-control-sm" style="width: auto;">
        <label for="to_date" class="form-label fw-semibold mb-0 small text-muted">To:</label>
        <input type="date" id="to_date" name="to_date" value="{{ to_date }}" class="form-control form-control-sm" style="width: auto;">
        <input type="hidden" name="type" value="{{ active_type }}">
        <input type="hidden" name="account" value="{{ account }}">
        <button type="submit" class="btn btn-sm btn-success">Apply</button>

    </form>
</div>

<!-- ðŸ”¹ Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ -->
<table class="table table-hover align-middle">
    <thead>
        <tr>
            <th>Date</th>
            <th>Account</th>
            <th>Category</th>
            <th class="text-end">Amount</th>
        </tr>
    </thead>
    <tbody>
    {% for tx in transactions %}
        <tr onclick="window.location='{% if tx.category.type in 'Income,Outcome' %}{% url 'edit_transaction' tx.id %}{% else %}{% url 'edit_transfer' tx.transfer_id %}{% endif %}'">
            <td>{{ tx.transaction_time|date:"Y-m-d H:i" }}</td>
            <td>{{ tx.account.name }}</td>
            <td>{{ tx.category.name }}</td>
            <td class="text-end {% if tx.category.type == 'Income' or tx.category.type == 'Transfer_to' %}text-success{% else %}text-danger{% endif %}">
                {% if tx.category.type == 'Income' or tx.category.type == 'Transfer_to' %}+{% else %}-{% endif %} {{ tx.amount }}
            </td>
        </tr>
    {% empty %}
        <tr>
            <td colspan="4" class="text-center text-muted py-3">No transactions found</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- ðŸ”¹ ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ð°Ð¼ -->
<div class="pagination-wrapper">
  {% if transactions.has_previous %}
    <a class="btn btn-outline-success pagination-btn"
       href="?page={{ transactions.previous_page_number }}&from_date={{ from_date }}&to_date={{ to_date }}&filter={{ active_filter }}{% if active_type %}&type={{ active_type }}{% endif %}{% if account %}&account={{ account }}{% endif %}">
       Previous
    </a>
  {% endif %}

  {% if transactions.has_next %}
    <a class="btn btn-next-custom pagination-btn"
       href="?page={{ transactions.next_page_number }}&from_date={{ from_date }}&to_date={{ to_date }}&filter={{ active_filter }}{% if active_type %}&type={{ active_type }}{% endif %}{% if account %}&account={{ account }}{% endif %}">
       Next
    </a>
  {% endif %}
</div>

<script src="{% static 'js/transactions_filters.js' %}"></script>

{% endblock %}
